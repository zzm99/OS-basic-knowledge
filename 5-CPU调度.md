# CPU调度

1. 进程执行由CPU执行和IO等待周期组成。进程在这两个状态之间切换。
2. 每当CPU空闲时，操作系统就必须从就绪队列中选择一个进程来执行。进程选择由短期调度程序或CPU调度程序执行。
3. 队列中的记录通常为进程控制块PCB。
4. CPU调度策略可在如下四种情况下发生：
   1. 当一个进程从运行状态切换到等待状态（IO请求，调用wait等待一个子进程终止）
   2. 当一个进程从运行状态切换到就绪状态（出现中断）
   3. 当一个进程从等待状态切换到就绪状态（IO完成）
   4. 当一个进程终止时
   5. 对于第1和第4两种情况，没有选择而只能调度，一个新进程必须被选择执行。对于第2和第3两种情况，则可以进行选择。
   6. 前者调度方案称为非抢占式的或协作的，后者称为抢占式的。
5. 抢占调度对访问共享数据是有代价的。
6. 抢占对于操作系统内核的设计也有影响。
7. 受中断影响的代码段必须加以保护以避免同时访问，为了这些代码段不被多个进程同时访问，在进入时要禁止中断，而在退出时要重新允许中断。
8. 分派程序是一个模块，用来将CPU的控制交给由短期调度程序选择的进程。其功能包括：切换上下文、切换到用户模式、跳转到用户程序的合适位置，以重新启动程序。
9. 分派程序停止一个进程而启动另一个所要花的时间称为分派延迟。
10. 调度准则：需要使CPU使用率和吞吐量最大化，而使周转时间、等待时间和响应时间最小化。绝大多数情况下需要优化平均值。某些情况下，需要优化最小值或最大值。
11. 具有合理的可预见的响应时间的系统，比对平均值来说更快但变化大的系统更为理想。
12. 调度算法：
    1.  先到先服务调度（FCFS）
    2.  最短作业优先调度（SJF）
    3.  优先级调度。优先级可通过内部或外部方式来定义。优先调度可以是抢占的或者非抢占的。优先调度算法的一个主要问题是无穷阻塞或饥饿，低优先级进程无穷等待问题的解决之一是老化，逐渐增加在系统中等待很长时间的进程的优先级。
    4.  轮转法调度（RR），专门为分时系统设计。增加了抢占以切换进程。RR算法平均等待时间通常较长。经验，80%的CPU区间应该小于时间片。
    5.  多级队列调度。
    6.  多级反馈队列调度。如果进程使用过多CPU时间，那么它会被转移到更低优先级队列（这种形式的老化组织了饥饿的发生）。
13. 多处理器调度分为非对称多处理（一个处理器管所有系统活动，其他管用户代码）和对称多处理（每个处理器自我调度）。
14. 处理器亲和性：努力使一个进程在同一个处理器上运行。软亲和性、硬亲和性。
15. 负载平衡：保持所有处理器的负载平衡，完全利用多处理器的优点。
16. 负载平衡常会抵消处理器亲和性的优点。